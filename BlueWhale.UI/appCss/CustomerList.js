require({cache:{"chanjet/form/SearchBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/on dojo/Evented dojo/dom-construct dojo/dom-style dojo/dom-attr dojo/dom-class dijit/_WidgetBase dijit/_FocusMixin dijit/_TemplatedMixin chanjet/util/query".split(" "),function(l,f,c,e,k,n,d,p,s,t,v,y,w){return l("chanjet.form.SearchBox",[t,y,v,k],{boxWidth:0,boxHeight:0,firstSelected:!1,defaultText:"",searchIcon:!0,editAble:!0,noResultHTML:"",ver:"SearchBox Version v2.3.0 2014-6-24",
defaultWidth:260,defaultHeight:30,inputWidth:0,keySelect:!1,selectIndex:-1,selectMax:-1,selectNode:null,listItems:null,baseClass:"searchbox",templateString:"\x3cdiv\x3e\x3cdiv data-dojo-attach-point\x3d'inputDivNode'\x3e\x3cinput type\x3d'text' data-dojo-attach-point\x3d'inputNode'\x3e\x3c/div\x3e\x3cdiv data-dojo-attach-point\x3d'placeholdNode' class\x3d'placehold'\x3e\x3c/div\x3e\x3ca data-dojo-attach-point\x3d'clearNode' class\x3d'btn clearBtn'\x3e\x3c/a\x3e\x3cdiv data-dojo-attach-point\x3d'submitNode' class\x3d'btn submitBtn'\x3e\x3c/div\x3e\x3cdiv data-dojo-attach-point\x3d'listNode' class\x3d'searchList'\x3e\x3cul data-dojo-attach-point\x3d'listBox'\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e",
postCreate:function(){this.inherited(arguments);this._init();this._bindEvent()},_bindEvent:function(){var a=this;this.own(e(this.inputNode,"mousedown",f.hitch(this,this._onMouseDown)),e(this.inputNode,"input",f.hitch(this,this._onInput)),e(this.inputNode,"paste",function(c){d.set(a.placeholdNode,"display","none")}),e(this.inputNode,"keydown",f.hitch(this,this._onKeyDown)),e(this.inputNode,"keyup",f.hitch(this,this._onKeyUp)),e(this.inputNode,"click",f.hitch(this,this.focus)),e(this.placeholdNode,
"click",f.hitch(this,this.focus)),e(this.submitNode,"click",f.hitch(this,this._onSearch)),e(this.clearNode,"click",f.hitch(this,this._onClear)),e(this.listNode,"mousedown",f.hitch(this,this._onListMouseSelected)),e(this.listNode,"mouseover",f.hitch(this,this._onListMouseOver)));dojo.isIE&&this.own(e(this.inputNode,"keyup",f.hitch(this,this._onKeyUp)));this.store&&this.store.url&&this.own(e(this.store,"datachanged",f.hitch(this,this._onStoreChange)))},getInput:function(){return this.inputNode.value},
setInput:function(a){this.inputNode.value=a;d.set(this.inputNode,"color","#4f5254");d.set(this.placeholdNode,{display:"none"})},getable:function(){return this.editAble},useable:function(){this.editAble=!0;p.remove(this.inputNode,"disabled");s.remove(this.domNode,"disable")},disable:function(){this.editAble=!1;p.set(this.inputNode,{disabled:"disabled"});s.add(this.domNode,"disable");d.set(this.clearNode,{display:"none"})},reset:function(){this.inputNode.value="";d.set(this.placeholdNode,{display:"block"});
d.set(this.clearNode,{display:"none"});d.set(this.listNode,{display:"none"});d.set(this.inputNode,{width:this.inputWidth+16+"px"})},_init:function(){var a=0<this.boxWidth?this.boxWidth:this.defaultWidth,c=0<this.boxHeight?this.boxHeight:this.defaultHeight,a=a-2,c=c-2;d.set(this.domNode,{width:a+"px",height:c+"px"});this.inputWidth=a-50;d.set(this.inputNode,{width:this.inputWidth+16+"px"});d.set(this.placeholdNode,{width:this.inputWidth+16+"px",height:c-4+"px",lineHeight:c-4+"px"});d.set(this.listNode,
{display:"none",top:c+"px",width:a+"px"});this.searchIcon||(d.set(this.submitNode,{display:"none"}),d.set(this.clearNode,{top:(c-16)/2+"px",right:"6px",display:"none"}));this.editAble||(s.add(this.domNode,"disable"),p.set(this.inputNode,{disabled:"disabled"}));this.defaultText&&(this.placeholdNode.innerHTML=this.defaultText)},_onIeInput:function(){"value"==window.event.propertyName&&this._onInput()},_onInput:function(){var a=this.inputNode.value;d.set(this.clearNode,{display:"block"});d.set(this.inputNode,
{width:this.inputWidth+"px"});this.store&&(""!=a?this._showList():this._hideList());this.emit("searchChange",a)},_onSearch:function(){this.editAble&&this.emit("searchEvent",this.inputNode.value)},_onClear:function(){this.inputNode.value="";d.set(this.placeholdNode,{display:"block"});d.set(this.clearNode,{display:"none"});d.set(this.listNode,{display:"none"});d.set(this.inputNode,{width:this.inputWidth+16+"px"});this.focus();this.emit("searchChange");this.emit("searchClear")},_checkPlaceHold:function(){var a=
this.inputNode.value;this.defaultText&&(""!=a?d.set(this.placeholdNode,"display","none"):d.set(this.placeholdNode,"display","block"))},_showList:function(){if(this.store&&this.store.url&&this.keyName){var a={params:{}};a.params[this.keyName]=this.inputNode.value;this.listBox.innerHTML="";this.store.load(a)}else this.store&&this.store.data&&this._showListData()},_onStoreChange:function(a){"loaded"==a.tag&&this._showListData()},_showListData:function(){var a,f,b,g=this.store.data;if(!this.url)var h=
this.getInput(),g=c.filter(g,function(b){return b.extraInfo?RegExp(h).test(b.extraInfo):RegExp(h).test(b.text)});if(g&&0<g.length){this.keySelect=!0;d.set(this.listNode,{display:"block"});this.listBox.innerHTML="";this.selectMax=b=g.length;this.listItems=[];for(a=0;a<b;a++)f=n.create("li"),w(f).text(g[a].text),dojo.place(f,this.listBox,"last"),this.listItems.push(f);this.firstSelected&&(this.selectIndex=0,this.selectNode=this.listItems[0],s.add(this.listItems[0],"selected"))}else this.keySelect=!1,
d.set(this.listNode,{display:"none"}),this.listBox.innerHTML=this.noResultHTML},_hideList:function(){this.keySelect=!1;this.selectMax=this.selectIndex=-1;d.set(this.clearNode,{display:""!=this.inputNode.value?"block":"none"});d.set(this.listNode,{display:"none"})},_onMouseDown:function(){this.editAble&&this._checkPlaceHold()},_onKeyDown:function(a){d.set(this.placeholdNode,"display","none");(40==a.keyCode||38==a.keyCode)&&""!=this.inputNode.value?0!=this.store.data.length&&(this.keySelect?(this.selectNode&&
s.remove(this.selectNode,"selected"),40==a.keyCode?(this.selectIndex+=1,this.selectIndex>=this.selectMax&&(this.selectIndex=0)):(this.selectIndex-=1,0>this.selectIndex&&(this.selectIndex=this.selectMax-1)),a=this.listNode.childNodes[0].children,s.add(a[this.selectIndex],"selected"),this.inputNode.value=w(a[this.selectIndex]).text(),d.set(this.placeholdNode,{display:"none"}),this.selectNode=a[this.selectIndex]):this._showList()):13==a.keyCode&&(this.keySelect?-1<this.selectIndex?(a=this.listNode.childNodes[0].children,
this.inputNode.value=a[this.selectIndex].innerHTML,this.emit("listSelected",this.inputNode.value,this.store.data[this.selectIndex]),this._hideList()):this.emit("searchEvent",this.inputNode.value):this.emit("searchEvent",this.inputNode.value))},_onKeyUp:function(a){d.set(this.placeholdNode,"display","none");40!=a.keyCode&&(38!=a.keyCode&&13!=a.keyCode)&&this._onInput()},_onListMouseSelected:function(a){a=a.target;"li"==a.tagName.toLowerCase()&&(this.inputNode.value=w(a).text(),d.set(this.placeholdNode,
{display:"none"}),this.emit("listSelected",this.inputNode.value,this.store.data[this.selectIndex]),this._hideList())},_onListMouseOver:function(a){this.selectNode&&s.remove(this.selectNode,"selected");s.add(a.target,"selected");this.selectNode=a.target;for(var d=a.target.parentNode.children,b=0,g=d.length;b<g;b++)if(d[b]==a.target){this.selectIndex=b;break}},onBlur:function(){this._hideList();this._checkPlaceHold();s.remove(this.domNode,"searchboxFocus")},focus:function(){var a=this.inputNode.value;
this.inputNode.focus();""!=a&&d.set(this.clearNode,{display:"block"});s.add(this.domNode,"searchboxFocus");this._showList()}})})},"app/vm/Category":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./tpl/category.html dojo/text!./tpl/categoryItem.html dojo/on dojo/_base/lang chanjet/widget/Dialog dojo/json dijit/form/CheckBox dojox/layout/ContentPane dijit/Tooltip chanjet/form/Label".split(" "),function(l,f,c,e,k,n,d,p,s,t,v,y,w){e=l("app.vm.Category",[f,c],{templateString:e,
from:null,postCreate:function(){this.itemsMap={};this.selectedMap={};this.dataMap={};this.showMap={};this.hideMap={};this.visibileMap={};this.unvisibileMap={};this._bindEvent();this.tip=new y({label:"aaaa",selector:"div.select-tag-more",connectId:[this.selectedNode],getContent:function(b){return App.escape(b.getAttribute("names"))}})},_bindEvent:function(){var b=this;this.own(this.store.on("datachanged",function(g){if("load"==g.tag){g=g.data;var h=g.length,A=0,c=b.itemsMap={},f=b.dataMap={},e=b.groupNode;
e.innerHTML="";for(var B=0;B<h;B++){var x=g[B],r=x.id;if(!b.from||!("customer_move"==b.from&&"owner"==r)){var q=new a({data:x,owner:b});e.appendChild(q.domNode);q.resize();c[r]=q;for(var m=d.clone(x),u=m.list,C={},k=0,l=u.length;k<l;k++){var D=u[k];C[D.id]=D}m.list=C;f[r]=m;"0"==x.visible?(b.unvisibileMap[r]=q,core.addClass(q.domNode,"hide")):4>A?(core.addClass(q.domNode,"show"),b.showMap[r]=q,b.visibileMap[r]=q,++A):(core.addClass(q.domNode,"hide"),b.hideMap[r]=q,b.visibileMap[r]=q)}}}}),n(this.selectedNode,
n.selector(".pill-cancle","click"),function(g){g=$(this.parentNode).closest("li",this.domNode)[0];var h=core.attr(g,"data-id");b.delAllTag(h,g);b.tip.close()}),n(this.saveNode,"click",function(g){g=b.selectedMap;var h=[],d={entityType:"Client"},a;for(a in g){for(var c=g[a],f=c.list,e=[],k=0,r=f.length;k<r;k++)e.push({id:f[k].id,name:f[k].name});defaultValueObj={fieldValue:c.id,fieldName:c.name,list:e};h.push({fieldName:a,defaultValue:s.stringify(defaultValueObj)})}0==h.length?App.tip("\u6ca1\u6709\u7b5b\u9009\u6761\u4ef6\u53ef\u6536\u85cf",
{cls:"warn"}):(d.entityType="Client",d.items=h,xhr.post(URL.saveHistory,d,function(b){App.tip("\u7b5b\u9009\u6761\u4ef6\u5df2\u4fdd\u5b58")}))}),n(this.clearNode,"click",function(g){b.clearCategorys();b.onDataChanged()}),n(this.moreNodeBtnOpen,"click",function(g){core.removeClass(b.moreNode,"show");core.addClass(b.moreNode,"hide");core.removeClass(b.foldNode,"hide");core.addClass(b.foldNode,"show");for(var h in b.hideMap)core.removeClass(b.hideMap[h].domNode,"hide"),core.addClass(b.hideMap[h].domNode,
"show")}),n(this.moreNodeBtnFold,"click",function(g){core.removeClass(b.foldNode,"show");core.addClass(b.foldNode,"hide");core.removeClass(b.moreNode,"hide");core.addClass(b.moreNode,"show");for(var h in b.hideMap)core.removeClass(b.hideMap[h].domNode,"show"),core.addClass(b.hideMap[h].domNode,"hide")}),n(this.moreNodeBtnConf1,"click",d.hitch(this,this.config)),n(this.moreNodeBtnConf2,"click",d.hitch(this,this.config)))},config:function(b){(new CategoryConfig({data:this.store.data,owner:this})).show()},
reset:function(b){this.clearCategorys(!0);this.showMap={};this.hideMap={};this.visibileMap={};this.unvisibileMap={};var g=1,h;for(h in this.itemsMap){var d=this.itemsMap[h];this.unvisibileMap[h]=d;core.removeClass(d.domNode,"show");core.addClass(d.domNode,"hide");for(var a=0;a<b.length;++a)if(h==b[a]){core.removeClass(d.domNode,"hide");core.addClass(d.domNode,"show");4>=g?(++g,this.showMap[h]=d,this.visibileMap[h]=d,delete this.hideMap[h]):(this.hideMap[h]=d,this.visibileMap[h]=d,delete this.showMap[h]);
delete this.unvisibileMap[h];break}}for(var c in this.dataMap){g=this.dataMap[c];g.visible="0";for(a=0;a<b.length;++a)if(c==b[a]){g.visible="1";break}}for(c=0;c<this.store.data.length;++c){g=this.store.data[c];g.visible="0";for(a=0;a<b.length;++a)if(g.id==b[a]){g.visible="1";break}}core.removeClass(this.moreNode,"show");core.addClass(this.moreNode,"hide");core.removeClass(this.foldNode,"hide");core.addClass(this.foldNode,"show")},addTag:function(b){var g=this.selectedMap,h=this.selectedNode,a=b.ownerId,
d=b.ownerName,c=b.id,f=b.name||"",e=b.multiSelect;if(g[a]){g=g[a].list;b=g.length;h="";for(e=0;e<b;e++)h+=g[e].name+"\uff0c";b=h+=f;a=$(this.selectedNode).query("li[data-id\x3d"+a+"] div");12<h.length&&(b=h.substr(0,12)+"...",a.addClass("select-tag-more"),a.attr("names",d+":"+App.escape(h)));a.query("span.pill-text").text(App.escape(b));g.push({id:c,name:f})}else{b=f;var k="";12<f.length&&(b=f.substr(0,12)+"...",k="select-tag-more");b=['\x3cli data-id\x3d"'+a+'" class\x3d"pill"\x3e','\x3cdiv names\x3d"'+
App.escape(f)+'" class\x3d"icon-tag '+k+'"\x3e',"\x3ch5\x3e"+d+'\uff1a\x3c/h5\x3e\x3cspan class\x3d"pill-text"\x3e'+App.escape(b)+"\x3c/span\x3e",'\x3cspan class\x3d"pill-cancle icon-btn-x"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/li\x3e'].join("");g[a]={id:a,name:d,multiSelect:e,list:[{id:c,name:f}]};h.appendChild(core.toDom(b))}this.onDataChanged()},delTag:function(b,g){if(this.selectedMap[b.ownerId]){var h=b.ownerId,a=b.ownerName,d=b.id,c=this.selectedMap[h].list,f=c.length,e="";if(1<f){for(var k=0,r=
0;r<f;r++)c[r].id==d?k=r:e+=c[r].name+"\uff0c";d=e=e.substring(0,e.length-1);h=$(this.selectedNode).query("li[data-id\x3d"+h+"] div");12<e.length?(d=e.substr(0,12)+"...",h.addClass("select-tag-more"),h.attr("names",a+":"+e)):h.removeClass("select-tag-more");h.attr("title",a+":"+e);h.query("span.pill-text").text(d);c.splice(k,1);this.onDataChanged()}else this.delAllTag(h,null,g)}},delAllTag:function(b,g,h){var a=this.selectedMap,d=a[b].list,c=this.itemsMap;g?$(g).remove():$(this.selectedNode).query("li[data-id\x3d"+
b+"]").remove();for(i in d)c[b].unselect(d[i].id);delete a[b];if(!h)this.onDataChanged()},clearCategorys:function(b){var g=this.selectedMap,a;for(a in g)this.delAllTag(a,null,!b)},addCategorys:function(b,g){core.removeClass(this,"hidden");this.clearCategorys();for(var a=this.selectedMap,d=this.selectedNode,c=this.itemsMap,f=b.length,e="",k=0;k<f;k++){var l=b[k],r=l.id,q=l.list,m="";a[r]=l;for(j in q){var u=q[j],m=m+((u.name||"")+"\uff0c");c[r].select(u.id)}q=m="\uff0c"==m.substring(m.length-1,m.length)?
m.substring(0,m.length-1):m;u=" ";12<m.length&&(q=m.substr(0,12)+"...",u="select-tag-more");l=['\x3cli data-id\x3d"'+r+'" class\x3d"pill"\x3e','\x3cdiv names\x3d"'+App.escape(m)+'" class\x3d"icon-tag '+u+'"\x3e',"\x3ch5\x3e"+App.escape(l.name)+'\uff1a\x3c/h5\x3e\x3cspan class\x3d"pill-text"\x3e'+App.escape(q)+"\x3c/span\x3e",'\x3cspan class\x3d"pill-cancle icon-btn-x"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/li\x3e'].join("");e+=l}d.appendChild(core.toDom(e));if(!g)this.onDataChanged()},onDataChanged:function(){}});
var a=l("app.vm.CategoryItem",[f,c],{templateString:k,postMixInProperties:function(){this.typeName=this.data.name},postCreate:function(){for(var b=this.data.list,g=b.length,a="",d=0;d<g;d++)var c=b[d],a=a+('\x3cli\x3e\x3ca data-id\x3d"'+c.id+'"  data-idx\x3d"'+d+'"\x3e\x3cdiv class\x3d"icon-btn-check-small"\x3e\x3c/div\x3e'+(App.escape(c.name)||"")+"\x3c/a\x3e\x3c/li\x3e");this.conNode.innerHTML=a;this._bindEvent()},_bindEvent:function(){var b=this,g=this.owner,a=this.data,d=a.list;this.own(n(this.moreNode,
"click",function(){b.toggleMore()}),n(this.conNode,n.selector("li a","click"),function(c){c=parseInt(core.attr(this,"data-idx"));c=d[c];var f=c.id,e={id:c.id,name:c.name,ownerId:a.id,ownerName:a.name};core.hasClass(this,"selected")?(b.unselect(f,this),g.delTag(e)):(a.multiSelect||(b.reset(),g.delTag(e,!0)),b.select(f,this,c),g.addTag(e))}))},select:function(b,a){a||(a=this.getTag(b));a&&core.addClass(a,"selected")},unselect:function(b,a){a||(a=this.getTag(b));a&&core.removeClass(a,"selected")},toggleMore:function(){var b=
this.domNode;core.hasClass(b,"state-unfold")?(core.removeClass(b,"state-unfold"),$(this.moreNode).html('\u66f4\u591a\x3cspan class\x3d"icon-btn-arrow-down-2"\x3e\x3c/span\x3e')):(core.addClass(b,"state-unfold"),$(this.moreNode).html('\u6536\u8d77\x3cspan class\x3d"icon-btn-arrow-up-2"\x3e\x3c/span\x3e'))},getTag:function(b){return $(this.conNode).query("a[data-id\x3d"+b+"]")[0]},resize:function(){40<this.conNode.scrollHeight?core.removeClass(this.moreNode,"hide"):core.addClass(this.moreNode,"hide")},
reset:function(){for(var b=$(this.conNode).query("a[class\x3dselected]"),a=0;a<b.length;++a)core.removeClass(b[a],"selected")}});l("CategoryConfig",[f],{configDialog:null,configPanel:null,data:null,owner:null,postCreate:function(){this.inherited(arguments)},show:function(b){var a=this;a.configPanel=new CategoryConfigEditPanel({data:this.data,owner:a});a.configDialog=new p({"class":"categoryConfig",bottomButtons:[{label:"\u53d6\u6d88",sTag:"cancel",baseClass:"whiteButton"},{label:"\u4fdd\u5b58",sTag:"ok",
baseClass:"whiteButton"}],title:"\u7ba1\u7406\u7b5b\u9009\u6761\u4ef6",autoDestroy:!0,contentMaxHeight:"auto",contentMinHeight:"100px",style:"width : 460px;",buttonClick:function(b,d,c){if("ok"==c){var e=a.configPanel.getResult();b={entityType:"Client",items:[]};for(var f in e)b.items.push({fieldName:e[f],visible:"1"});0!=b.items.length&&(App.showLoading(),xhr.post(URL.configSave,b,function(b){App.hideLoading();a.owner.reset(e)}),a.destroy())}else a.destroy()}});a.configDialog.addChild(a.configPanel);
a.configDialog.show()},validate:function(){for(var b=this.configPanel.getResult(),a=this.configDialog._bottomButtonslist,d=0,c=a.length;d<c;d++)"ok"==a[d].sTag&&0==b.length?a[d].set("disabled",!0):a[d].set("disabled",!1)},destroy:function(){this.configPanel.destroy();this.configDialog.destroy();this.inherited(arguments)}});l("CategoryConfigEditPanel",[f,c],{templateString:"\x3cdiv\x3e\x3cdiv class\x3d'fl' data-dojo-attach-point\x3d'leftpanel'\x3e\x3c/div\x3e\x3cdiv class\x3d'fl' data-dojo-attach-point\x3d'rightpanel'\x3e\x3c/div\x3e\x3c/div\x3e",
data:null,owner:null,leftPanel:null,rightPanel:null,postCreate:function(){this.leftPanel=new v({},this.leftpanel);this.rightPanel=new v({},this.rightpanel);for(var b=0;b<this.data.length;++b){var a=new z({name:this.data[b].name,value:this.data[b].id,checked:"1"==this.data[b].visible?!0:!1,owner:this});this.owner.owner.from&&("customer_move"==this.owner.owner.from&&"owner"==this.data[b].id)&&core.addClass(a.domNode,"hide");0==b%2?this.leftPanel.addChild(a):this.rightPanel.addChild(a)}this.inherited(arguments)},
getResult:function(){for(var a=[],d=this.leftPanel.getChildren(),c=0;c<d.length;++c)d[c].isChecked()&&a.push(d[c].value);d=this.rightPanel.getChildren();for(c=0;c<d.length;++c)d[c].isChecked()&&a.push(d[c].value);return a}});var z=l("cCheckBox",[f,c],{templateString:"\x3cdiv class\x3d'cCheckBox'\x3e\x3cdiv data-dojo-attach-point\x3d'checkbox'\x3e\x3c/div\x3e\x3cdiv data-dojo-attach-point\x3d'label'\x3e\x3c/div\x3e\x3c/div\x3e",labelComp:null,checkboxComp:null,owner:null,postCreate:function(){this.labelComp=
new w({value:this.name},this.label);this.checkboxComp=new t({name:this.name,value:this.value,checked:this.checked},this.checkbox);this.own(n(this.checkboxComp,"change",d.hitch(this,this.onClick)));this.inherited(arguments)},isChecked:function(){return this.checkboxComp.checked},onClick:function(){this.owner.owner.validate()}});return e})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),
function(l,f,c,e,k,n,d,p,s){e("dijit-legacy-requires")&&n(0,function(){l(["dijit/form/RadioButton"])});return f("dijit.form.CheckBox",[d,p],{templateString:s,baseClass:"dijitCheckBox",_setValueAttr:function(d,c){"string"==typeof d&&(this.inherited(arguments),d=!0);this._created&&this.set("checked",d,c)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},
_fillContent:function(){},_onFocus:function(){this.id&&k("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&k("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(l,f,c,e){return l("dijit.form.ToggleButton",[c,e],{baseClass:"dijitToggleButton",setChecked:function(c){f.deprecated("setChecked("+
c+") is deprecated. Use set('checked',"+c+") instead.","","2.0");this.set("checked",c)}})})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(l,f){return l("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(c){var e=this.checked;this._set("checked",!e);var f=this.inherited(arguments);this.set("checked",f?this.checked:e);return f},_setCheckedAttr:function(c,e){this._set("checked",c);var k=this.focusNode||this.domNode;
this._created&&f.get(k,"checked")!=!!c&&f.set(k,"checked",!!c);k.setAttribute(this._aria_attr,String(c));this._handleOnChange(c,e)},postCreate:function(){this.inherited(arguments);var c=this.focusNode||this.domNode;this.checked&&c.setAttribute("checked","checked")},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(l,f){return l("dijit.form._CheckBoxMixin",null,{type:"checkbox",
value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(c){this._set("readOnly",c);f.set(this.focusNode,"readOnly",c)},_setLabelAttr:void 0,_getSubmitValue:function(c){return null==c||""===c?"on":c},_setValueAttr:function(c){c=this._getSubmitValue(c);this._set("value",c);f.set(this.focusNode,"value",c)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));f.set(this.focusNode,"value",this.value)},_onClick:function(c){return this.readOnly?
(c.stopPropagation(),c.preventDefault(),!1):this.inherited(arguments)}})})},"chanjet/form/Label":function(){define(["dojo/_base/declare","dojo/on","dojo/_base/lang","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(l,f,c,e,k,n){return l("chanjet.form.Lable",[e,k],{templateString:'\x3clabel id\x3d"widget_${id}" for\x3d"${forWhat}" role\x3d"presentation"\x3e${value}\x3c/label\x3e',value:"",forWhat:"",baseClass:"chanjetLabel",postMixInProperties:function(){this.id=this.id||"label"+(Math.random()*
Math.pow(10,6)).toString().substr(0,6);this.inherited(arguments)},_setValueAttr:function(d){this.domNode.innerHTML=d}})})},"url:app/nav/tpl/customerList.html":'\x3cdiv class\x3d"customer_list w1000"\x3e\n\n    \x3cdiv class\x3d"listHead"\x3e\n        \x3cspan class\x3d"title" data-dojo-attach-event\x3d"onclick:_refresh"\x3e\u6211\u7684\u5ba2\u6237\x3c/span\x3e\n        \x3ca class\x3d"searchCollect" data-dojo-attach-point\x3d"searchCollect"\x3e\u5df2\u6536\u85cf\u641c\u7d22\u6761\u4ef6\x3cspan data-dojo-attach-point\x3d"searchCollectSpan" class\x3d"icon-btn-arrow-down-2"\x3e\x3c/span\x3e\x3c/a\x3e\n        \x3ca class\x3d"fr addButton" data-dojo-attach-point\x3d"importBtnNode" data-dojo-attach-event\x3d"onclick:_onImportCustomer" style\x3d"display:none;"\x3e\x3cspan class\x3d"addIcon"\x3e\x3c/span\x3e\u5bfc\u5165Excel\x3c/a\x3e\n        \x3ca class\x3d"fr addButton" data-dojo-attach-point\x3d"newBtnNode" data-dojo-attach-event\x3d"onclick:_onNewCustomer"\x3e\x3cspan class\x3d"addIcon"\x3e\x3c/span\x3e\u65b0\u589e\u5ba2\u6237\x3c/a\x3e\n        \x3cdiv class\x3d"searchBox fr" data-dojo-attach-point\x3d"searchBoxNode"\x3e\n            \x3cdiv class\x3d\'searchInput\' data-dojo-attach-point\x3d\'searchinputpanel\'\x3e\x3c/div\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"hidden" style\x3d"position: relative;" data-dojo-attach-point\x3d"categoryNode"\x3e\x3c/div\x3e\n    \x3cdiv data-dojo-attach-point\x3d"listPanel"\x3e\x3c/div\x3e\n\x3c/div\x3e',
"url:app/vm/tpl/category.html":'\x3cdiv class\x3d"cat"\x3e\n    \x3cdiv class\x3d"cat-topbar clearfix"\x3e\n       \x3cdiv class\x3d"cat-oper"\x3e\n           \x3ca data-dojo-attach-point\x3d"saveNode"\x3e\u6536\u85cf\u6761\u4ef6\x3c/a\x3e\n           \x3ca data-dojo-attach-point\x3d"clearNode"\x3e\u6e05\u7a7a\u6761\u4ef6\x3c/a\x3e\n       \x3c/div\x3e\n        \x3cdiv class\x3d"has-arrow"\x3e\n            \u5df2\u9009\u6761\u4ef6\uff1a\x3cspan class\x3d"nav-topbar-arror icon-supple-arrow-right"\x3e\x3c/span\x3e\n        \x3c/div\x3e\n       \x3cul class\x3d"selected-con" data-dojo-attach-point\x3d"selectedNode"\x3e\n       \x3c/ul\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"cat-content"\x3e\n       \x3cdiv class\x3d"cat-group" data-dojo-attach-point\x3d"groupNode"\x3e\x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"moreBtn"\x3e\n        \x3cdiv class\x3d"moreBtnCenter" data-dojo-attach-point\x3d"moreNode"\x3e\n            \x3cdiv class\x3d"moreNodeBtnOpen" data-dojo-attach-point\x3d"moreNodeBtnOpen"\x3e\x3ca\x3e\u66f4\u591a\x3cspan class\x3d"icon-btn-arrow-down-2"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\n            \x3cdiv class\x3d"moreBtnCenterDot"\x3e|\x3c/div\x3e\n            \x3cdiv class\x3d"search-setIcon" data-dojo-attach-point\x3d"moreNodeBtnConf1"\x3e\x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"moreBtnCenter hide" data-dojo-attach-point\x3d"foldNode"\x3e\n            \x3cdiv class\x3d"moreNodeBtnOpen" data-dojo-attach-point\x3d"moreNodeBtnFold"\x3e\x3ca\x3e\u6536\u8d77\x3cspan class\x3d"icon-btn-arrow-up-2"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\n            \x3cdiv class\x3d"moreBtnCenterDot"\x3e|\x3c/div\x3e\n            \x3cdiv class\x3d"search-setIcon" data-dojo-attach-point\x3d"moreNodeBtnConf2"\x3e\x3c/div\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n\x3c/div\x3e\n',
"url:app/vm/tpl/categoryItem.html":'\x3cdiv class\x3d"category"\x3e\n    \x3ch4\x3e${typeName}\x3cspan\x3e:\x3c/span\x3e\x3c/h4\x3e\n    \x3ca class\x3d"category-more J_More hide" data-dojo-attach-point\x3d"moreNode" href\x3d"javascript:void(0)" \x3e\u66f4\u591a\n        \x3cspan class\x3d"icon-btn-arrow-down-2"\x3e\x3c/span\x3e\n    \x3c/a\x3e\n    \x3c!--\x3ca class\x3d"multi-choice J_MultiChoice" href\x3d"javascript:void(0)" \x3e\u591a\u9009\x3c/a\x3e--\x3e\n    \x3cdiv class\x3d"category-wrap"\x3e\n        \x3cul class\x3d"category-content" data-dojo-attach-point\x3d"conNode"\x3e\x3c/ul\x3e\n    \x3c/div\x3e\n\x3c/div\x3e',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\n\t\x3e\x3cinput\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\n\t\tdata-dojo-attach-point\x3d"focusNode"\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\n/\x3e\x3c/div\x3e\n'}});
define("app/nav/CustomerList","dojo/_base/declare dijit/_TemplatedMixin dojo/text!./tpl/customerList.html app/util/_WidgetBase chanjet/util/JsonStore chanjet/form/SearchBox dojo/_base/lang dojo/on dojo/_base/array dojo/cookie dojo/dom-construct dojo/dom-style dijit/TooltipDialog chanjet/form/Popover dijit/popup dojo/json app/vm/Category app/vm/CustomerGrid dojo/mouse dojox/layout/ContentPane chanjet/form/Label app/vm/CustomerEditDialog".split(" "),function(l,f,c,e,k,n,d,p,s,t,v,y,w,a,z,b,g,h,A,E,
F,G){c=l("app/nav/CustomerList",[e,f],{templateString:c,searchStore:null,searchInput:null,grid:null,init:function(a,b,d){var c=this,f=this.category;b&&0==b.indexOf("y\x3d")&&(this.scrollYTo=b.split("\x3d")[1]);f&&f.clearCategorys();this.catStore.load({callback:function(){for(var b=f.dataMap,d=a.split("\x26"),e=[],g=null,q=0,h=d.length;q<h;q++){var m=d[q].split("\x3d"),k=m[0];if(2==m.length)if("pageno"==k)k=parseInt(m[1]),c.grid.listStore.pageNo=k;else if("_dc"!=k)if("searchValue"==k)g=decodeURIComponent(m[1]);
else{for(var m=m[1].split(","),l=b[k],n=l.name,l=l.list,p=0,s=m.length;p<s;p++)m[p]=l[m[p]];e.push({id:k,name:n,list:m})}}null!=g?(c.searchInput.setInput(g),c.categoryLoad({searchValue:g})):(f.addCategorys(e,!0),c.categoryLoad())}});0===App.privilege&&y.set(this.importBtnNode,"display","block")},load:function(a){var b=this.scrollYTo;b&&!this.firstInit&&(this.firstInit=!0,a.callback=function(){App.hideLoading();window.scrollTo(0,b)});this.grid.load(a)},categoryLoad:function(a){a=a||{};(!a.searchValue||
""==a.searchValue)&&this.searchInput.reset();var c={},f={},e=this.category.selectedMap;for(i in e){for(var g=e[i],h=[],k=g.list,l=0,n=k.length;l<n;l++)h.push(k[l].id);f[g.id]=h}d.mixin(f,a);c.queryValue=b.stringify(f);this.load(c)},postCreate:function(){this.lastParams={};this.uid=App.userId;this._initSearchBox();this._initList();this._initCategory();var a=this;this.own(p(this.searchCollect,A.enter,d.hitch(this,this.onShowSearchCollect)),p(this.searchCollect,A.leave,d.hitch(this,this.onHidePopup)));
this.inherited(arguments);setTimeout(function(){xhr.get(URL.customer+"/sharedGuide",function(b){!0===b.result&&(pos=core.position(a.category.moreNodeBtnOpen),dom=dojo.toDom('\x3cdiv class\x3d"share-tip" style\x3d"position: absolute;top:'+(pos.y-45)+"px;left:"+(pos.x+50)+'px;"\x3e\x3cdiv class\x3d"icon-btn-x"\x3e\x3c/div\x3e\x3cdiv\x3e\u5ba2\u6237\u5df2\u7ecf\u68c0\u6d4b\u5230\u6709\u4eba\u628a\u5ba2\u6237\u5171\u4eab\u7ed9\u4f60\uff01\x3cbr/\x3e\u70b9\u51fb"\u66f4\u591a"\uff0c\u4f7f\u7528\u6761\u4ef6\u6765\u67e5\u8be2\u6211\u53c2\u4e0e\u7684\u5ba2\u6237\x3cbr/\x3e\u66f4\u65b9\u4fbf\u54e6\x3c/div\x3e\x3c/div\x3e'),
dom.onclick=function(a){0<$(a.target).closest(".icon-btn-x",dom).length&&$(dom).remove()},core.place(dom,a.domNode))})},800)},_initCategory:function(){var a=this,b=this.catStore=new k({url:URL.configList});(this.category=new g({store:b,onDataChanged:function(){a.grid.listStore.pageNo=1;a.categoryLoad()}})).placeAt(this.categoryNode)},addCategorys:function(a){core.removeClass(this.categoryNode,"hidden");this.category.addCategorys(a)},listDataChange:function(a,b){b?core.addClass(this.categoryNode,"hidden"):
core.removeClass(this.categoryNode,"hidden")},_initSearchBox:function(){if(this.searchInput)this.searchInput.setInput("");else{var a=t(this.uid),b=[];if(a)for(var b=a.split(","),a=0,c=b.length;a<c;a++)b[a]={id:a,text:b[a],value:b[a]};b=this.searchBoxStore=new k({data:b});b=this.searchInput=new n({boxWidth:368,boxHeight:43,store:b,defaultText:"\u8bf7\u8f93\u5165\u5ba2\u6237\u540d\u79f0\u8fdb\u884c\u67e5\u8be2"},this.searchinputpanel);(a=this.searchName)&&b.setInput(a);a=this.clearBtn=v.toDom('\x3cdiv class\x3d"search-clear"\x3e\u6e05\u9664\u5386\u53f2\u8bb0\u5f55\x3c/div\x3e');
dojo.place(a,b.listNode);this.own(p(this.clearBtn,"click",d.hitch(this,this._clearBtnClick)),p(this.searchInput,"searchEvent",d.hitch(this,this._searchEventHandler)),p(this.searchInput,"searchClear",d.hitch(this,this._searchClearHandler)),p(this.searchInput,"listSelected",d.hitch(this,this._searchSelectedHandler)))}},_initList:function(){this.grid=(new h({target:this,from:"customer_list"})).placeAt(this.listPanel)},_clearBtnClick:function(){t(this.uid,"");this.searchBoxStore.removeAll();this.searchInput._hideList()},
_searchEventHandler:function(a){var c=this.uid;a=d.trim(a);params=this.packageListQueryParams();params.queryValue=b.stringify({searchValue:encodeURI(a)});this.grid.listStore.load({params:params});this.category.clearCategorys();var f=t(c)||"",e=this.searchBoxStore,g=f.split(",");if(!s.some(g,function(b){return b==a}))if(e.insert(0,{id:this.searchBoxStore.getCount(),text:a,value:a}),f)if(g=e.getCount(),10<g){for(var f=e.data,f=f.splice(g-10),g="",h=0,k=f.length,l=k-1;h<k;h++)g=h!=l?g+(f[h].text+","):
g+f[h].text;t(c,g,{expires:30});e.setData(f)}else t(c,a+","+f,{expires:30});else t(c,a,{expires:30})},_searchClearHandler:function(a){this.categoryLoad()},_searchSelectedHandler:function(a,c,d){this.searchInput.setInput(a);params=this.packageListQueryParams();params.queryValue=b.stringify({searchValue:encodeURI(a)});this.grid.listStore.load({params:params});this.category.clearCategorys()},packageListQueryParams:function(){var a={pageno:this.grid.urlPageno,queryType:"",queryValue:{}};1<a.queryType.length&&
(a.queryType=a.queryType.substring(0,a.queryType.length-1));a.queryValue.searchValue=encodeURIComponent(this.searchInput.getInput());a.queryValue=b.stringify(a.queryValue);return a},_onNewCustomer:function(){(new G).show(d.hitch(this,function(){router.go("customer_list/0/0/"+(new Date).valueOf())}));App.bdstatEvent("\u5ba2\u6237\u5217\u8868-\u65b0\u589e\u5ba2\u6237")},_onImportCustomer:function(){App.user.superUser&&(router.go("customer_import/init/excel/"+(new Date).valueOf()),App.bdstatEvent("\u5ba2\u6237\u5217\u8868-\u5bfc\u5165\u5ba2\u6237"))},
onHidePopup:function(){var a=this;this.userTimer=setTimeout(function(){z.close();a.cardTip.destroy()},200)},_refresh:function(){router.go("customer_list/0/0"+(new Date).valueOf())},onShowSearchCollect:function(){var b=this;b.userTimer&&clearTimeout(b.userTimer);var c=new B({parentTarget:b});b.cardTip=new a({content:c,baseClass:"cont-card",onMouseLeave:function(){b.onHidePopup()},onBlur:function(){z.close(this)},onMouseEnter:function(){b.userTimer&&clearTimeout(b.userTimer)}});z.open({popup:b.cardTip,
around:b.searchCollect,orient:["below","above"]});return b.cardTip},destroy:function(){this.catStore.destroy();this.category.destroy();this.inherited(arguments)}});var B=l("SearchCollect",[e,f],{templateString:'\x3cdiv style\x3d"background-color: #ffffff;width: 645px;min-height: 40px;"\x3e\x3cdiv data-dojo-attach-point\x3d"mainpanel"\x3e\x3c/div\x3e\x3c/div\x3e',url:null,mainPanel:null,parentTarget:null,postCreate:function(){this.mainPanel=new E({},this.mainpanel);this.reload()},reload:function(){for(var a=
this,c=a.mainPanel.getChildren(),d=0;d<c.length;++d)c[d].destroyRecursive(!1);xhr.get(URL.searchCollectList,{},function(c){for(var d=0,f=c.length;d<f&&10!=d;++d){for(var g=c[d].list,e="",h=0;h<g.length;++h){for(var k=b.parse(g[h].defaultValue),e=e+"\x3ca class\x3d'SearchCollectItemTextSpan'\x3e",l=0;l<k.list.length;++l)e+=k.list[l].name+",";","==e.substring(e.length-1,e.length)&&(e=e.substring(0,e.length-1));e+="\x3c/a\x3e"}g=new x({content:e,data:c[d],parentTarget:a});(9==d||d+1==c.length)&&a.setStyle(g.itemNode,
"border-bottom","none");a.mainPanel.addChild(g)}0==c.length&&a.mainPanel.addChild(new F({value:"\x3cdiv style\x3d'height: 40px;line-height: 40px;'\x3e\u8fd8\u6ca1\u6709\u5df2\u6536\u85cf\u7684\u67e5\u8be2\u6761\u4ef6\x3c/div\x3e"}))})}}),x=l("SearchCollectItem",[e,f],{templateString:'\x3cdiv class\x3d"SearchCollectItem" data-dojo-attach-point\x3d"itemNode"\x3e\x3cdiv class\x3d"search-collect-del-h" data-dojo-attach-point\x3d"headpanel"\x3e\x3c/div\x3e\x3cdiv class\x3d"SearchCollectItemText" data-dojo-attach-point\x3d"itempanel"\x3e\x3c/div\x3e\x3cdiv class\x3d"search-collect-del-i" data-dojo-attach-point\x3d"delpanel"\x3e\x3c/div\x3e\x3c/div\x3e',
content:null,data:null,parentTarget:null,postCreate:function(){this.itempanel.innerHTML=this.content;this.own(p(this.itempanel,"click",d.hitch(this,this.select)),p(this.delpanel,"click",d.hitch(this,this.del)))},select:function(){for(var a=[],c=0;c<this.data.list.length;++c){var d=b.parse(this.data.list[c].defaultValue);a.push({id:d.fieldValue,name:d.fieldName,list:d.list})}this.parentTarget.parentTarget.addCategorys(a);this.parentTarget.parentTarget.onHidePopup()},del:function(){var a=this;xhr.del(URL.searchCollectDel+
"?versionId\x3d"+this.data.versionId,{versionId:this.data.versionId},function(b){a.parentTarget.reload()})}});return c});
